<%- include("templates/header") %>
<div class="container">
    <div class="row">
        <div class="col-12 col-md-6">
            <h2><%=recipe.Name  %></h2>

            <img src="<%= recipe.Image_Link %>" alt="{{ recipe.Name }}" class="img-fluid">
            
        </div>
        <div class="col-12 col-md-6">
            <h3>Ingredients</h3>
            <ul>
              <% let i = 0; %>
                <% recipe.UpdatedRecipeIngredientParts.forEach((recipeIngredientPart) => { %>
                    <li><%= measureUnits[i] %> <%= recipeIngredientPart %></li>
                    <% i++; %>
                <% }); %>
            </ul>

            <h3>Instructions</h3>
            <ol>
                <li><%=recipe.RecipeInstructions%></li>

            </ol>

            <div class="row flex-row justify-content-around">
                <div class="col-6 col-md-4 text-center">
                    
                    <button  class="btn" id="favoritebtn" > <i class="fas fa-heart"></i></button>
                    
                </div>
                <div class="col-6 col-md-4 text-center">
                    <form method="get" action="/customizeRecipe">
                    <button id="customizeBtn" class="btn" >Customize</button>
                    </form>
                    <br>
                    <br>
                    <br>
                    <br>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
const favoriteBtn = document.getElementById('favoritebtn');
const recipeId = "<%= recipe._id %>";
let isFavorite;

fetch('/favorites/check', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({ recipeId }),
})
  .then((response) => response.json())
  .then((data) => {
    // Handle the response from the server
    if (data.favorited) {
      favoriteBtn.classList.add('btn-success'); // Change button color to success
      isFavorite = true;
      console.log(isFavorite)
      console.log("Recipe is favorited");
    }
    else {
      isFavorite = false;
      console.log(isFavorite)
      console.log("Recipe is not favorited");
    }
  })
  .catch((error) => {
    console.error('Error checking if recipe is favorited:', error);
  });


favoriteBtn.addEventListener('click', () => {
    
  if (isFavorite) {
    // Recipe is already a favorite, so remove it
    removeFromFavorites(recipeId);
    //reload page
    location.reload();
  } else {
    // Recipe is not a favorite, so add it
    addToFavorites(recipeId);
    location.reload();
  }
});

function addToFavorites(recipeId) {
  // Send an AJAX request to add the recipe to favorites
  fetch('/favorites/add', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ recipeId }),
  })
    .then((response) => response.json())
    .then((data) => {
      // Handle the response from the server
      if (data.success) {
        favoriteBtn.classList.add('btn-success'); // Change button color to success
        isFavorite = true;
      }
    })
    .catch((error) => {
      console.error('Error:', error);
    });
}

function removeFromFavorites(recipeId) {
  // Send an AJAX request to remove the recipe from favorites
  console.log("remove from favorites");
  fetch('/favorites/remove', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ recipeId }),
  })
    .then((response) => response.json())
    .then((data) => {
      // Handle the response from the server
      if (data.success) {
        favoriteBtn.classList.remove('btn-success'); // Change button color to success
        isFavorite = false;
      }
    })
    .catch((error) => {
      console.error('Error:', error);
    });
}

</script>
<%- include("templates/footer") %>